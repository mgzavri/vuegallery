(function(t){function e(e){for(var i,o,s=e[0],c=e[1],l=e[2],u=0,d=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);h&&h(e);while(d.length)d.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},r={app:0},a=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var h=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1971:function(t,e,n){t.exports={contWidthMax:"892",contWidthMin:"320",imageMin:"100",colsMax:"5",colsMin:"1",touchduration:"500"}},"2fc4":function(t,e,n){t.exports={contWidthMax:"892",contWidthMin:"320",imageMin:"100",colsMax:"5",colsMin:"1",touchduration:"500"}},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",attrs:{id:"app"}},[n("Gallery"),t._m(0)],1)},a=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"disclaimer",attrs:{id:"disclaimer"}},[n("h1",[t._v("Управление галереей")]),n("ul",[n("li",[t._v(' Вставьте в поле ссылку на изображение и нажмите "Загрузить" или перетащите в поле галереи изображение (или несколько) с компьютера. '),n("br"),t._v(" Изображение добавится в галерею."),n("br"),t._v(" Файлы, не являющееся изображениями, проигнорируются."),n("br")]),n("li",[t._v(' Вставьте в поле ссылку на JSON файл, возвращающий объект, содержащий массив объектов со свойством "url" (адреса изображений), например:'),n("br"),n("a",{attrs:{href:"https://don16obqbay2c.cloudfront.net/frontend-test-task/gallery-images.json"}},[t._v(" https://don16obqbay2c.cloudfront.net/frontend-test-task/gallery-images.json")]),n("br"),t._v(' и нажмите "Загрузить". '),n("br"),t._v(" Или перетащите его в поле галереи."),n("br"),t._v(" Галерея заполнится картинками. ")]),n("li",[t._v(" Для удаления картинки из галереи перетащите ее за границы контейнера в подсвечиваемую область. На мобильном устройстве - задержите палец на картинке и свайпните или так же перетащите за границы контейнера. ")])])])}],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"all"},[n("div",{staticClass:"overlay",class:{danger:t.danger,transparent:t.ready},on:{drop:function(e){t.removePic(e.dataTransfer.getData("index"))},dragover:function(t){t.preventDefault()},dragleave:function(e){t.ready=!1},dragenter:function(e){t.danger=t.innerEvent}}}),n("div",{ref:"gallery",staticClass:"gallery",class:{ready:t.ready},on:{dragenter:function(e){return t.addRemoveClasses()}}},[n("h1",[t._v("VueGallery")]),n("GalleryUpload",{on:{uploadJSON:t.uploadJSON,uploadIMG:t.prepareImg}}),n("div",{ref:"gallery_size",staticClass:"gallery__block",attrs:{id:"galleryBlock"}},[t.rows.length>0?n("div",{staticClass:"gallery__block"},t._l(t.galleryImages,(function(e,i){return n("div",{key:i,staticClass:"gallery__block_container",style:{width:t.rows[i].widthPerCent+"%",height:"auto"},attrs:{draggable:"true",gen:e.gen,id:i},on:{dragstart:function(e){return t.onDragStart(e,i)},dragend:function(e){return t.showDisclaimer()},touchstart:function(e){return t.setTouchTimer(e)},touchmove:function(e){return t.touchMove(e)},touchend:function(e){return t.touchEnd()},touchcancel:function(e){return t.touchCancel()}}},[n("img",{staticClass:"gallery__block_img",attrs:{src:e.url,alt:"",width:"100%",height:"100%",id:"img"+i}})])})),0):t._e()])],1)])},s=[],c=n("2909"),l=n("1da1"),h=(n("96cf"),n("a434"),n("159b"),n("ac1f"),n("5319"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("99af"),n("d81d"),n("1971")),u=n.n(h),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"upload"},[n("div",{staticClass:"upload__input_div"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"upload__input_input",attrs:{type:"text",autofocus:"",maxlength:"100",id:"linkInput",placeholder:"Вставьте ссылку"},domProps:{value:t.input},on:{input:function(e){e.target.composing||(t.input=e.target.value)}}})]),n("button",{staticClass:"upload__button",attrs:{type:"submit",name:"action"},on:{click:function(e){return e.preventDefault(),t.checkMimeType(e)}}},[t._v(" Загрузить ")])])},p=[],g={data:function(){return{input:"",ImagesObject:{}}},methods:{checkMimeType:function(){var t=this,e=new Image;e.src=this.input,e.onload=function(){return t.emitImgToGallery(e.src)},e.onerror=function(){return t.checkJSON()}},checkJSON:function(){var t=this;fetch(this.input).then(function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.blob());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(e){"application/json"===e.type&&t.emitJSONToGallery()})).catch((function(){alert("Ссылка не рабочая"),t.input=""}))},emitImgToGallery:function(t){this.$emit("uploadIMG",t),this.input=""},emitJSONToGallery:function(){this.$emit("uploadJSON",this.input)}}},f=g,m=n("2877"),v=Object(m["a"])(f,d,p,!1,null,"2898a6bc",null),y=v.exports,b={data:function(){return{galleryImages:[],contWidthMax:u.a.contWidthMax,contWidthMin:u.a.contWidthMin,colsMax:u.a.colsMax,colsMin:u.a.colsMin,imageMin:u.a.imageMin,contWidth:0,tempArray:[],rows:[],danger:!1,ready:!1,innerEvent:!1,ddEvents:["dragend","dragover","dragenter","dragleave","drop"],touchableElement:{},touchXposition:0,touchYposition:0,touchElY:0,touchElX:0,touchStartX:0,touchStartY:0,galleryTop:0,galleryBottom:0,galleryLeft:0,galleryRight:0,touchduration:u.a.touchduration,timer:0,lockTimer:!1,touchStarted:!1,touchStartMoveTime:0}},components:{GalleryUpload:y},mounted:function(){for(var t=0;t<3;t++)this.addDefaultPics();this.promiceContWidth(),document.getElementsByClassName("gallery__block_img").ondragstart=function(){return!1},window.addEventListener("resize",this.promiceContWidth,{passive:!0}),this.notNativeEvents(),this.onGalleryDrop()},beforeDestroy:function(){window.removeEventListener("resize",this.setContWidth)},computed:{currentArea:function(){for(var t=0,e=0;e<=Math.round((this.contWidthMax-this.contWidthMin)/this.imageMin);e++)this.contWidth>=this.contWidthMax-this.imageMin*e&&this.contWidth<this.contWidthMax-this.imageMin*(e-1)&&(t=e);return t}},watch:{currentArea:function(){this.startCalculate()},galleryImages:function(){this.danger=!1,this.ready=!1,this.startCalculate(),this.galleryCoords()}},methods:{addDefaultPics:function(){var t="images/no_image.jpg";this.uploadIMG(t,640,426,"default")},removeDefaults:function(){"default"===this.galleryImages[0].gen&&this.galleryImages.splice(0,1)},notNativeEvents:function(){this.ddEvents.forEach(function(t){this.$refs.all.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation()}.bind(this),!1)}.bind(this))},onGalleryDrop:function(){var t=this;this.$refs.gallery.addEventListener("drop",(function(e){return t.insertToGallery(e)}),!1),this.innerEvent=!1,this.ready=!1},insertToGallery:function(t){var e=t.dataTransfer.files;if(e.length>0)for(var n=0;n<e.length;n++){var i=e[n].type;if("image"===i.replace(/\/.+/,"")){var r=URL.createObjectURL(e[n]);this.prepareImg(r)}else"application/json"===i?this.parseJSON(URL.createObjectURL(e[n])):alert("Только изображения или JSON-файл")}},uploadJSON:function(t){this.parseJSON(t)},parseJSON:function(t){var e=this;fetch(t).then(function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(n){var i,r,a,o,s,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.json();case 2:if(i=t.sent,n.ok){t.next=6;break}return r=i&&i.message||n.statusText,t.abrupt("return",Promise.reject(r));case 6:for(s in a=[],o=[],i)for(c=0;c<i[s].length;c++)i[s][c].url?o.push(i[s][c].url):a.push(c);if(!(o.length>0)){t.next=20;break}e.galleryImages=[],l=0;case 12:if(!(l<o.length)){t.next=18;break}return t.next=15,e.prepareImg(o[l]);case 15:l++,t.next=12;break;case 18:t.next=21;break;case 20:return t.abrupt("return",Promise.reject("В полученном файле не найдено ни одного url"));case 21:if(!(a.length>0)){t.next=23;break}return t.abrupt("return",Promise.reject("В полученном файле для некоторых записей не указаны url"));case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){alert(t)}))},prepareImg:function(t){var e=this,n=new Image;n.src=t,n.onload=function(){return e.uploadIMG(n.src,n.width,n.height,"received")}},uploadIMG:function(t,e,n,i){"default"!==i?(this.galleryImages.push({url:t,width:e,height:n,gen:i}),this.removeDefaults()):this.galleryImages.unshift({url:t,width:e,height:n,gen:i})},galleryCoords:function(){var t=document.getElementById("galleryBlock").getBoundingClientRect();this.galleryTop=t.top,this.galleryLeft=t.left,this.galleryBottom=t.bottom,this.galleryRight=t.right},onDragStart:function(t,e){this.innerEvent=!0,t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("index",e),t.target.classList.add("draggable"),this.hideDisclaimer()},setTouchTimer:function(t){var e=this;this.lockTimer||1===t.targetTouches.length&&(this.timer=setTimeout((function(){return e.touchStart(t)}),this.touchduration),this.lockTimer=!0)},touchStart:function(t){t.preventDefault(),this.touchStarted=!0,this.innerEvent=!0,this.hideDisclaimer();var e=t.targetTouches[0];this.touchableElement=e.target,this.touchStartX=e.pageX,this.touchStartY=e.pageY,this.touchElX=e.pageX-e.target.offsetLeft,this.touchElY=e.pageY-e.target.offsetTop,this.touchXposition=e.pageX,this.touchYposition=e.pageY,e.target.classList.add("touchable"),this.touchableElement.style.left=this.touchXposition-this.touchElX+"px",this.touchableElement.style.top=this.touchYposition-this.touchElY+"px"},touchMove:function(t){if(t.preventDefault(),this.touchStartMoveTime=(new Date).getTime(),this.touchStarted){var e=t.targetTouches[0];this.touchXposition=e.pageX,this.touchYposition=e.pageY,this.touchableElement.style.left=this.touchXposition-this.touchElX+"px",this.touchableElement.style.top=this.touchYposition-this.touchElY+"px",this.touchXposition<this.galleryLeft||this.touchYposition<this.galleryTop||this.touchXposition>this.galleryRight||this.touchYposition>this.galleryBottom?this.danger=!0:this.danger=!1}},touchEnd:function(){this.clearTimer();var t=(new Date).getTime();this.touchStarted=!1,this.touchableElement.id>-1&&(this.clearTouchable(),t-this.touchStartMoveTime<100&&(Math.abs(this.touchXposition-this.touchStartX)>100||Math.abs(this.touchYposition-this.touchStartY)>100)||this.touchXposition<this.galleryLeft||this.touchYposition<this.galleryTop||this.touchXposition>this.galleryRight||this.touchYposition>this.galleryBottom?this.removePic(this.touchableElement.id):this.danger=!1)},touchCancel:function(){this.clearTimer(),this.touchStarted&&(this.danger=!1,this.clearTouchable())},clearTimer:function(){clearTimeout(this.timer),this.lockTimer=!1,this.touchStarted=!1},clearTouchable:function(){this.touchableElement.style.left="",this.touchableElement.style.top="",this.touchableElement.classList.remove("touchable"),this.showDisclaimer()},addRemoveClasses:function(){this.danger=!1,this.ready=!this.innerEvent},removePic:function(t){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.ready=!1,!e.innerEvent){n.next=10;break}return n.next=4,e.galleryImages.splice(t,1);case 4:if(!(e.galleryImages.length<3)){n.next=7;break}return n.next=7,e.addDefaultPics();case 7:e.innerEvent=!1,n.next=11;break;case 10:e.danger=!1;case 11:case"end":return n.stop()}}),n)})))()},promiceContWidth:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.contWidth=t.$refs.gallery_size.clientWidth,e.next=3,t.startCalculate();case 3:case"end":return e.stop()}}),e)})))()},startCalculate:function(){this.rows=[],this.tempArray=Object(c["a"])(this.galleryImages),this.getAllRows()},getAllRows:function(){while(this.tempArray.length>0)this.rows=this.rows.concat(this.getRowArray())},getRowArray:function(){for(var t=this.getRow(),e=Math.min.apply(Math,Object(c["a"])(t.map((function(t){return t.width})))),n=this.colsMax;n>=this.colsMin;n--)if(t=this.getRow(n),e=Math.min.apply(Math,Object(c["a"])(t.map((function(t){return t.width})))),e>=this.imageMin)break;return this.tempArray.length===t.length&&t[0].height>250&&(t=this.getFixRow()),this.tempArray.splice(0,t.length),t},getRow:function(t){var e=[],n=Object(c["a"])(this.tempArray),i=0,r=0;if(n.length>1){for(var a=0;a<t&&a<this.tempArray.length;a++)n[a].ratio=n[a].width/n[a].height,r+=n[a].ratio;for(var o=0;o<t&&o<this.tempArray.length;o++){i=this.contWidth/r;var s=n[o].ratio/r*100,l=i*n[o].width/n[o].height;e[o]={widthPerCent:s,width:l,height:i}}}else{var h=this.contWidth/2>250?250:this.contWidth/2,u=h*n[0].width/n[0].height,d=u/this.contWidth*100;e[0]={widthPerCent:d,width:u,height:h}}return e},getFixRow:function(){for(var t=this.contWidth/2>250?250:this.contWidth/2,e=Object(c["a"])(this.tempArray),n=[],i=0;i<this.tempArray.length;i++){var r=t*e[i].width/e[i].height,a=r/this.contWidth*100;n[i]={widthPerCent:a,width:r,height:t}}return n},hideDisclaimer:function(){document.getElementById("disclaimer").style.display="none"},showDisclaimer:function(){document.getElementById("disclaimer").style.display="block"}}},w=b,x=Object(m["a"])(w,o,s,!1,null,null,null),M=x.exports,_={name:"App",components:{Gallery:M}},E=_,T=Object(m["a"])(E,r,a,!1,null,null,null),k=T.exports;n("2fc4");i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(k)}}).$mount("#app")}});
//# sourceMappingURL=app.5d714a9d.js.map